parameters:
  - name: Paths
    type: object
    default: []
  - name: Repositories
    type: object
    default:
      - Name: $(Build.Repository.Name)
        Commitish: $(Build.SourceVersion)
        WorkingDirectory: $(System.DefaultWorkingDirectory)
  - name: SkipDefaultCheckout
    type: boolean
    default: false

steps:
  - ${{ if not(parameters.SkipDefaultCheckout) }}:
    - checkout: none

  - task: PowerShell@2
    displayName: 'Sparse checkout repositories'
    inputs:
      targetType: filePath
      filePath: /eng/common/scripts/sparse-checkout.ps1
      arguments: >
        -Paths '${{ convertToJson(parameters.Paths) }}'
        -Repositories '${{ convertToJson(parameters.Repositories) }}'
      pwsh: true
      workingDirectory: $(System.DefaultWorkingDirectory)
